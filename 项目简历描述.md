# 多模态人员重识别系统 (Multi-Modal Person Re-Identification)

## 项目概述
基于PRCV2025全模态行人重识别挑战赛，开发了一套支持多模态融合的人员重识别系统。该系统采用前沿的Vision Transformer架构和高级多模态融合技术，能够处理可见光、红外、彩绘、素描和文本五种模态，实现跨模态检索和多模态组合查询，在公共安全、智慧交通等领域具有重要应用价值。

## 技术架构

### 核心技术栈
- **深度学习框架**: PyTorch
- **视觉编码器**: Vision Transformer (ViT-Base) - 更强的特征提取能力
- **文本编码器**: Sentence Transformers (all-MiniLM-L6-v2)
- **多模态融合**: 层次化多头注意力机制 + 跨模态Transformer块
- **高级技术**: 模态特异性Prompt学习、LayerScale、自监督预训练
- **损失函数**: 高级对比学习损失 + 跨模态对齐损失
- **评估指标**: mAP@100, CMC@1/5/10

### 系统架构设计
```
输入层 → 模态编码器 → 模态Prompt → 层次化融合 → 分类器 → 输出
  ↓         ↓           ↓           ↓         ↓       ↓
多模态数据  ViT/Transformer 模态特异性  跨模态融合  身份分类  检索结果
```

## 核心功能实现

### 1. 高级视觉编码器
- **Vision Transformer**: 使用ViT-Base替代ResNet50，更强的特征提取能力
- **模态特异性Prompt**: 为每种模态设计专门的Prompt学习机制
- **门控机制**: 动态控制Prompt的激活程度，提高模态适应性
- **LayerScale**: 使用LayerScale技术提高训练稳定性

### 2. 层次化多模态融合
- **跨模态Transformer块**: 实现早期融合，学习模态间相互关系
- **层次化融合**: 多尺度早期+晚期融合策略
- **全局融合Token**: 使用全局Token聚合所有模态信息
- **模态特异性Token**: 为每种模态设计专门的融合Token

### 3. 高级损失函数设计
- **改进的对比学习**: 支持Hard Negative Mining和跨模态对齐
- **InfoNCE损失**: 使用温度参数和margin优化对比学习
- **跨模态对齐损失**: 确保不同模态特征在统一空间对齐
- **自监督预训练**: 掩码模态建模任务提高模型泛化能力

### 4. 训练策略优化
- **Warmup + Cosine调度**: 更平滑的学习率变化
- **模态Dropout**: 随机丢弃部分模态，提高模型鲁棒性
- **平衡采样**: 确保每个批次包含多个身份，避免BatchNorm问题
- **梯度裁剪**: 防止梯度爆炸，提高训练稳定性

## 技术亮点

### 1. 前沿架构设计
- **ViT Backbone**: 使用Vision Transformer替代CNN，更强的特征提取能力
- **模态特异性Prompt**: 为每种模态设计专门的Prompt，提高模态适应性
- **层次化融合**: 多尺度融合策略，更好地利用模态互补信息
- **跨模态Transformer**: 早期融合机制，学习模态间相互关系

### 2. 高级训练技术
- **LayerScale**: 使用LayerScale技术提高训练稳定性
- **Hard Negative Mining**: 改进的对比学习，挖掘困难负样本
- **跨模态对齐**: 确保不同模态特征在统一空间对齐
- **自监督预训练**: 掩码模态建模任务提高模型泛化能力

### 3. 鲁棒性设计
- **模态缺失处理**: 当某些模态不可用时，系统仍能正常工作
- **门控Prompt**: 动态控制Prompt激活程度，适应不同模态
- **内存优化**: 使用LayerNorm和LayerScale，减少内存占用
- **批次大小自适应**: 动态调整批次大小，避免训练问题

### 4. 评估体系完善
- **训练监控**: 实时显示分类准确率，快速反馈训练状态
- **检索评估**: 使用标准ReID指标mAP@100和CMC@k
- **本地验证**: 在训练集上划分验证集进行性能评估

## 项目成果

### 性能指标
- **支持模态**: 5种模态（可见光、红外、彩绘、素描、文本）
- **查询类型**: 支持单模态、双模态、三模态、四模态组合查询
- **检索能力**: 从任意模态组合查询到可见光gallery的检索
- **评估标准**: 符合PRCV2025竞赛标准的mAP@100评估
- **模型架构**: 基于Vision Transformer的前沿架构

### 应用价值
- **公共安全**: 支持多种监控设备的数据融合分析
- **智慧交通**: 跨模态人员识别和追踪
- **社会服务**: 多模态身份验证和识别

## 技术挑战与解决方案

### 挑战1: 模态间特征差异
**问题**: 不同模态（如红外vs可见光）特征分布差异巨大
**解决**: 使用模态特异性Prompt学习和门控机制，动态适应不同模态特征

### 挑战2: 多模态融合策略
**问题**: 如何有效融合不同模态的互补信息
**解决**: 采用层次化融合和跨模态Transformer块，实现早期+晚期融合

### 挑战3: 训练稳定性
**问题**: 多模态训练容易出现梯度不稳定
**解决**: 使用LayerScale、Warmup调度、Hard Negative Mining等先进技术

### 挑战4: 模型泛化能力
**问题**: 如何提高模型在未见模态组合上的泛化能力
**解决**: 采用自监督预训练和跨模态对齐损失，提高模型泛化性

## 代码质量

### 工程化实践
- **模块化设计**: 数据集、模型、训练脚本分离
- **配置管理**: 使用dataclass统一管理超参数
- **日志系统**: 完整的训练日志和性能监控
- **错误处理**: 完善的异常处理和边界情况处理

### 代码规范
- **中文注释**: 所有关键函数都有详细的中文注释
- **类型提示**: 使用类型注解提高代码可读性
- **文档完善**: 详细的README和API文档

## 项目特色

1. **前沿技术**: 采用Vision Transformer、Prompt学习等最新技术
2. **竞赛导向**: 基于PRCV2025官方数据集和评估标准
3. **实用性强**: 支持真实场景中的多模态查询需求
4. **工程化程度高**: 完整的训练、验证、评估流程

## 技术栈总结
- **深度学习**: PyTorch, Vision Transformer, Sentence Transformers
- **多模态融合**: 层次化注意力机制, 跨模态Transformer, Prompt学习
- **数据处理**: PIL, torchvision, 数据增强
- **评估指标**: mAP, CMC, 检索性能评估
- **工程工具**: 日志系统, 配置管理, 模型保存
